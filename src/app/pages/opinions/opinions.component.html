<main class="overflow-auto py-5 px-sm-5 px-4">
    <section class="view" *ngIf="!form">
      <h3>Opiniones</h3>
      <form class="d-flex flex-wrap justify-content-end gap-3 mb-3">
        <div class="form-floating">
          <input class="form-control" [value]="searchValue" type="text" placeholder=" " #search>
          <label>Buscar</label>
        </div>
        <div class="form-floating">
          <select class="form-select" style="max-width: 250px;" #selectSubject>
            <option [value]="''">Todas las materias</option>
            <option *ngFor="let item of subjects" [selected]="selectSubjectValue == item.id" [value]="item.id">{{item.name}}</option>
          </select>
          <label>Materias</label>
        </div>
        <div class="form-floating">
          <i class="fas fa-caret-down position-absolute mx-3 my-4 end-0 top-0"></i>
          <input class="form-control pe-5" type="text" id="listTags" placeholder=" " (input)="filterList()" (click)="filterList()" (focus)="filterCategory.click()" (click)="filterCategory.classList.contains('show') && filterCategory.click()" data-bs-toggle="dropdown" autocomplete="off" #filterCategory>
          <ul class="dropdown-menu overflow-auto w-100 shadow-sm" style="max-height: 178px;">
            <li><button type="button" class="dropdown-item item_tag" (click)="filterList(item)" [value]="item.id" *ngFor="let item of tags">{{item.name}}</button></li>
          </ul>
          <label>Tags</label>
        </div>
        <button class="btn btn-1 mt-auto" (click)="filterSubjects(selectSubject.value, search.value)">
          Buscar
        </button>
      </form>
      <div class="mb-3 d-flex gap-3 justify-content-end flex-wrap">
        <span class="bg-gray py-1 px-2 rounded-pill" *ngFor="let item of tagsSelected, let i = index">
          {{item.name}}
          <small class="far fa-times-circle text-danger" role="button" (click)="tagsId.splice(i, 1)" (click)="tagsSelected.splice(i, 1)"></small>
        </span>
      </div>
      <section class="d-flex flex-column gap-3" id="accOpinion">
        <div class="row g-3">
          <div class="col-xxl-4 col-lg-6" *ngFor="let item of opinions, let i = index">
            <div class="d-flex flex-column h-100 bg-gray2 rounded-7 p-4">
                <div class="d-flex gap-3 mb-2">
                  <img class="rounded-circle border" [src]="item.student.image.url" width="50px" height="50px" alt="userImage">
                  <h5 class="m-0">{{item.title}}</h5>
                </div>
                <div><span class="fw-500">Escrito por: </span> {{item.student.name +' '+ item.student.lastname}}</div>
                <div><span class="fw-500">Profesor: </span> {{item.professor}}</div>
                <div><span class="fw-500">Materia: </span> {{item.subject.name}}</div>
                <p class="my-2 cnt-ellipsis">{{item.description}}</p>
                <div class="d-flex gap-2 flex-wrap">
                  <small class="color-1" *ngFor="let tag of item.opinionTags">#{{tag.tag.name}}</small>
                </div>
                <div class="d-flex gap-2 py-3 flex-wrap">
                  <small class="bg-gray px-3 py-2 rounded-pill">
                    <i class="far fa-comments color-1 fs-6 me-1"></i>
                    {{item.answersCount}} respuestas
                  </small>
                  <small class="bg-gray px-3 py-2 rounded-pill">
                    <i class="far fa-calendar-alt color-1 fs-6 me-1"></i>
                    {{item.created_at | date: 'dd/MM/YY | HH:mm'}}
                  </small>
                </div>
                <div class="d-flex gap-2 flex-wrap mt-auto">
                  <i class="far fa-trash-alt text-danger btn-gray rounded-circle" role="button" (click)="delete(item.id, i)" style="padding: 10px 12px;"></i>
                  <!-- <button class="btn btn-danger col" [routerLink]="[]" [queryParams]="{form: i}">Eliminar</button> -->
                  <button class="btn btn-1 col" [routerLink]="[]" [queryParams]="{form: i}">Ver hilo</button>
                </div>
            </div>
          </div>
        </div>
      </section>
      <section class="text-center position-relative pt-4">
        <small class="alert p-2 bg-danger rounded-7 text-white position-absolute top-0 start-50 translate-middle" *ngIf="showAlert">No hay mas resultados</small>
        <button class="btn btn-1" (click)="listOpinions(selectSubject.value, search.value)">
          Ver mas
        </button>
      </section>
    </section>
    <section class="view" *ngIf="form">
      <h3>Informacion del hilo</h3>
      <div class="d-flex flex-column h-100 border my-3 rounded-7 p-4">
        <div class="d-flex gap-3 mb-2">
          <img class="rounded-circle border" [src]="opinions[form]?.student?.image?.url" width="50px" height="50px" alt="userImage">
          <h5 class="m-0">{{opinions[form]?.title}}</h5>
        </div>
        <div><span class="fw-500">Escrito por: </span> {{opinions[form]?.student?.name +' '+ opinions[form]?.student?.lastname}}</div>
        <div><span class="fw-500">Profesor: </span> {{opinions[form]?.professor}}</div>
        <div><span class="fw-500">Materia: </span> {{opinions[form]?.subject?.name}}</div>
        <p class="my-2">{{opinions[form]?.description}}</p>
        <div class="d-flex gap-2 flex-wrap">
          <small class="color-1" *ngFor="let tag of opinions[form]?.opinionTags">#{{tag.tag.name}}</small>
        </div>
        <div class="d-flex gap-2 pt-3 flex-wrap">
          <small class="bg-gray px-3 py-2 rounded-pill">
            <i class="far fa-comments color-1 fs-6 me-1"></i>
            {{opinions[form]?.answersCount}} respuestas
          </small>
          <small class="bg-gray px-3 py-2 rounded-pill">
            <i class="far fa-calendar-alt color-1 fs-6 me-1"></i>
            {{opinions[form]?.created_at | date: 'dd/MM/YY | HH:mm'}}
          </small>
        </div>
      </div>
      <small class="color-1" role="button" data-bs-toggle="collapse" data-bs-target="#collRes">Responder al hilo</small>
      <div class="collapse" [id]="'collRes'">
        <form class="p-2 position-relative">
          <input class="form-control" type="text" #inputAnswer>
          <button class="far fa-paper-plane position-absolute top-0 end-0 m-3 p-1 btn-transparent" (click)="createAnswer(inputAnswer, form)"></button>
        </form>
      </div>
      <div class="mt-2 border p-1 rounded-7">
        <div class="p-3 border rounded-7 d-flex gap-3 my-2" *ngFor="let answer of answers">
          <img class="rounded-circle border" [src]="answer.student.image.url" width="50px" height="50px" alt="userImage">
          <div>
            <h5>{{answer.student.name}}</h5>
            <p class="mb-2">{{answer.description}}</p>
            <small>{{answer.created_at | date: 'dd/MM/YY | HH:mm'}}</small>
          </div>
        </div>
        <div class="p-2 text-center" *ngIf="answers.length == 0">
          No hay respuesta en este comentario :(
        </div>
      </div>
    </section>
</main>
